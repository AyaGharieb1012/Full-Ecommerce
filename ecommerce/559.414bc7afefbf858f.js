"use strict";(self.webpackChunkecommerce=self.webpackChunkecommerce||[]).push([[559],{8559:(f,p,o)=>{o.r(p),o.d(p,{CartsComponent:()=>l});var _=o(6814),h=o(1120),t=o(4769),C=o(9779);function u(n,g){if(1&n){const e=t.EpF();t.TgZ(0,"div",9)(1,"div",10),t._UZ(2,"img",11),t.qZA(),t.TgZ(3,"div",12)(4,"div")(5,"h3",13),t._uU(6),t.qZA(),t.TgZ(7,"p",14),t._uU(8),t.ALo(9,"currency"),t.qZA(),t.TgZ(10,"button",15,16),t.NdJ("click",function(){const a=t.CHM(e).$implicit,m=t.MAs(11),b=t.oxw(2);return t.KtG(b.removeItem(a.product._id,m))}),t._UZ(12,"i",17),t._uU(13," Remove "),t.qZA()(),t.TgZ(14,"div",18)(15,"button",19,20),t.NdJ("click",function(){const a=t.CHM(e).$implicit,m=t.MAs(16),b=t.MAs(21),v=t.oxw(2);return t.KtG(v.changeCount(a.count-1,a.product._id,m,b))}),t._uU(17," - "),t.qZA(),t.TgZ(18,"span"),t._uU(19),t.qZA(),t.TgZ(20,"button",19,21),t.NdJ("click",function(){const a=t.CHM(e).$implicit,m=t.MAs(16),b=t.MAs(21),v=t.oxw(2);return t.KtG(v.changeCount(a.count+1,a.product._id,m,b))}),t._uU(22," + "),t.qZA()()()()}if(2&n){const e=g.$implicit;t.xp6(2),t.Q6J("src",e.product.imageCover,t.LSH)("alt",e.product.title),t.xp6(4),t.Oqu(e.product.title),t.xp6(2),t.hij("price : ",t.xi3(9,5,e.price,"EGP "),""),t.xp6(11),t.Oqu(e.count)}}const s=function(n){return["/payment",n]};function d(n,g){if(1&n){const e=t.EpF();t.TgZ(0,"section",2)(1,"div",3)(2,"h2"),t._uU(3,"Shop Cart"),t.qZA(),t.TgZ(4,"button",4),t.NdJ("click",function(){t.CHM(e);const c=t.oxw();return t.KtG(c.clearCart())}),t._uU(5,"Clear Cart"),t.qZA()(),t.TgZ(6,"p",5),t._uU(7),t.ALo(8,"currency"),t.qZA(),t.YNc(9,u,23,8,"div",6),t.TgZ(10,"button",7),t._uU(11," Online Payment "),t._UZ(12,"img",8),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(7),t.hij(" Total Price : ",t.xi3(8,3,e.cartDetails.totalCartPrice,"EGP")," "),t.xp6(2),t.Q6J("ngForOf",e.cartDetails.products),t.xp6(1),t.Q6J("routerLink",t.VKq(6,s,e.cartDetails._id))}}function r(n,g){1&n&&(t.TgZ(0,"h3",22),t._uU(1,"Your Cart Is Empty..."),t.qZA())}let l=(()=>{class n{constructor(e,i){this._CartsService=e,this._Renderer2=i,this.cartDetails=null}ngOnInit(){this._CartsService.getUserCart().subscribe({next:e=>{console.log(e),this.cartDetails=e.data}})}removeItem(e,i){this._Renderer2.setAttribute(i,"disabled","true"),this._CartsService.removeUserCart(e).subscribe({next:c=>{console.log(c),this.cartDetails=c.data,this._Renderer2.removeAttribute(i,"disabled"),this._CartsService.cartNumber.next(c.numOfCartItems)},error:()=>{this._Renderer2.removeAttribute(i,"disabled")}})}changeCount(e,i,c,a){e>=1&&(this._Renderer2.setAttribute(c,"disabled","true"),this._Renderer2.setAttribute(a,"disabled","true"),this._CartsService.updateCartCount(i,e).subscribe({next:m=>{this.cartDetails=m.data,this._Renderer2.removeAttribute(c,"disabled"),this._Renderer2.removeAttribute(a,"disabled")},error:m=>{this._Renderer2.removeAttribute(c,"disabled"),this._Renderer2.removeAttribute(a,"disabled")}}))}clearCart(){this._CartsService.clearCart().subscribe({next:e=>{"success"==e.message&&(this.cartDetails=null,this._CartsService.cartNumber.next(0))}})}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(C._),t.Y36(t.Qsj))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-carts"]],standalone:!0,features:[t.jDz],decls:3,vars:2,consts:[["class","w-75 mx-auto rounded shadow p-3 mb-3 bg-main-light",4,"ngIf","ngIfElse"],["msg",""],[1,"w-75","mx-auto","rounded","shadow","p-3","mb-3","bg-main-light"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-sm","btn","btn-outline-danger",3,"click"],[1,"text-main"],["class","row border-bottom py-2",4,"ngFor","ngForOf"],[1,"btn-main","mt-3",3,"routerLink"],["src","./assets/images/visa-1.svg","alt","visalogo"],[1,"row","border-bottom","py-2"],[1,"col-md-1"],[1,"w-100",3,"src","alt"],[1,"col-md-11","d-flex","justify-content-between","align-items-center"],[1,"h6"],[1,"text-main","small","mb-0"],[1,"btn","m-0","p-0","text-main",3,"click"],["btnRemove",""],[1,"fas","fa-trash-can"],[1,"p-1"],[1,"btn","btn-sm","border-success","m-2",3,"click"],["btn1",""],["btn2",""],[1,"text-center"]],template:function(i,c){if(1&i&&(t.YNc(0,d,13,8,"section",0),t.YNc(1,r,2,0,"ng-template",null,1,t.W1O)),2&i){const a=t.MAs(2);t.Q6J("ngIf",c.cartDetails)("ngIfElse",a)}},dependencies:[_.ez,_.sg,_.O5,_.H9,h.rH]})}return n})()},9779:(f,p,o)=>{o.d(p,{_:()=>u});var _=o(8784),h=o(5619),t=o(4769),C=o(9862);let u=(()=>{class s{constructor(r){this._HttpClient=r,this.baseUrl="https://ecommerce.routemisr.com/api/v1/",this.cartNumber=new h.X(0)}addToCart(r){return this._HttpClient.post(this.baseUrl+"cart",{productId:r})}getUserCart(){return this._HttpClient.get(this.baseUrl+"cart")}removeUserCart(r){return this._HttpClient.delete(this.baseUrl+`cart/${r}`)}updateCartCount(r,l){return this._HttpClient.put(this.baseUrl+`cart/${r}`,{count:l})}clearCart(){return this._HttpClient.delete(this.baseUrl+"cart/")}decodeUser(){const r=localStorage.getItem("etoken");if(null!==r){const l=(0,_.o)(r);this.userInfo=l}}checkOut(r,l){return this._HttpClient.post(this.baseUrl+`orders/checkout-session/${r}?url=http://localhost:4200`,{shippingAddress:l})}getUserOrder(r){return this._HttpClient.get(this.baseUrl+`orders/user/${r}`)}static#t=this.\u0275fac=function(l){return new(l||s)(t.LFG(C.eN))};static#e=this.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})()},8784:(f,p,o)=>{o.d(p,{o:()=>C});class _ extends Error{}function C(u,s){if("string"!=typeof u)throw new _("Invalid token specified: must be a string");s||(s={});const d=!0===s.header?0:1,r=u.split(".")[d];if("string"!=typeof r)throw new _(`Invalid token specified: missing part #${d+1}`);let l;try{l=function t(u){let s=u.replace(/-/g,"+").replace(/_/g,"/");switch(s.length%4){case 0:break;case 2:s+="==";break;case 3:s+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function h(u){return decodeURIComponent(atob(u).replace(/(.)/g,(s,d)=>{let r=d.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}(s)}catch{return atob(s)}}(r)}catch(n){throw new _(`Invalid token specified: invalid base64 for part #${d+1} (${n.message})`)}try{return JSON.parse(l)}catch(n){throw new _(`Invalid token specified: invalid json for part #${d+1} (${n.message})`)}}_.prototype.name="InvalidTokenError"}}]);